{% doc %}
  @prompt
    Can you help to generate icons where the customer can chose different color options for the product?, how do i link the icons to different products?, I'd like to be able to set the icon border width to 0

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-color-icons-{{ ai_gen_id }} {
    display: flex;
    flex-wrap: wrap;
    gap: {{ block.settings.icon_spacing }}px;
    align-items: center;}

  .ai-color-icon-{{ ai_gen_id }} {
    position: relative;
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    border-radius: {{ block.settings.border_radius }}px;
    {% if block.settings.border_width > 0 %}
      border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    {% else %}
      border: none;
    {% endif %}
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    text-decoration: none;
  }

  .ai-color-icon-{{ ai_gen_id }}:hover {
    transform: scale({{ block.settings.hover_scale }});
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .ai-color-icon-{{ ai_gen_id }}.selected {
    border-color: {{ block.settings.selected_border_color }};
    border-width: {{ block.settings.selected_border_width }}px;
    border-style: solid;
    box-shadow: 0 0 0 2px {{ block.settings.selected_ring_color }};
  }

  .ai-color-icon-solid-{{ ai_gen_id }} {
    background-color: var(--ai-color-value-{{ ai_gen_id }});
  }

  .ai-color-icon-pattern-{{ ai_gen_id }} {
    background: linear-gradient(45deg, 
      var(--ai-color-value-{{ ai_gen_id }}) 25%, 
      transparent 25%, 
      transparent 75%, 
      var(--ai-color-value-{{ ai_gen_id }}) 75%
    ),
    linear-gradient(45deg, 
      var(--ai-color-value-{{ ai_gen_id }}) 25%, 
      {{ block.settings.pattern_secondary_color }} 25%, 
      {{ block.settings.pattern_secondary_color }} 75%, 
      var(--ai-color-value-{{ ai_gen_id }}) 75%
    );
    background-size: 8px 8px;
    background-position: 0 0, 4px 4px;
  }

  .ai-color-icon-gradient-{{ ai_gen_id }} {
    background: linear-gradient(135deg, 
      var(--ai-color-value-{{ ai_gen_id }}) 0%, 
      {{ block.settings.gradient_end_color }} 100%
    );
  }

  .ai-color-icon-image-{{ ai_gen_id }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ai-color-icon-checkmark-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 16px;
    color: {{ block.settings.checkmark_color }};
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .ai-color-icon-{{ ai_gen_id }}.selected .ai-color-icon-checkmark-{{ ai_gen_id }} {
    opacity: 1;
  }

  .ai-color-label-{{ ai_gen_id }} {
    margin-top: 8px;
    font-size: {{ block.settings.label_font_size }}px;
    color: {{ block.settings.label_color }};
    text-align: center;
  }

  .ai-color-option-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .ai-product-info-{{ ai_gen_id }} {
    margin-top: 4px;
    text-align: center;
  }

  .ai-product-price-{{ ai_gen_id }} {
    font-size: {{ block.settings.price_font_size }}px;
    color: {{ block.settings.price_color }};
    font-weight: 600;
  }

  @media screen and (max-width: 749px) {
    .ai-color-icon-{{ ai_gen_id }} {
      width: {{ block.settings.icon_size | times: 0.8 }}px;
      height: {{ block.settings.icon_size | times: 0.8 }}px;
    }
    
    .ai-color-icons-{{ ai_gen_id }} {
      gap: {{ block.settings.icon_spacing | times: 0.8 }}px;
    }
  }
{% endstyle %}

<color-picker-{{ ai_gen_id }}
  class="ai-color-icons-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  {% for i in (1..8) %}
    {% liquid
      assign color_enabled_key = 'color_' | append: i | append: '_enabled'
      assign color_value_key = 'color_' | append: i | append: '_value'
      assign color_label_key = 'color_' | append: i | append: '_label'
      assign color_image_key = 'color_' | append: i | append: '_image'
      assign color_type_key = 'color_' | append: i | append: '_type'
      assign product_key = 'color_' | append: i | append: '_product'

      assign color_enabled = block.settings[color_enabled_key]
      assign color_value = block.settings[color_value_key]
      assign color_label = block.settings[color_label_key]
      assign color_image = block.settings[color_image_key]
      assign color_type = block.settings[color_type_key]
      assign linked_product = block.settings[product_key]%}

    {% if color_enabled %}
      <div class="ai-color-option-{{ ai_gen_id }}">
        {% if linked_product != blank %}
          <a
            href="{{ linked_product.url }}"
            class="ai-color-icon-{{ ai_gen_id }} ai-color-icon-{{ color_type }}-{{ ai_gen_id }} {% if forloop.first %}selected{% endif %}"
            style="--ai-color-value-{{ ai_gen_id }}: {{ color_value }};"
            data-color="{{ color_value }}"data-label="{{ color_label }}"
            data-product-id="{{ linked_product.id }}"
            aria-label="View {{ linked_product.title }} in {{ color_label }}"
          >{% else %}
          <button
            class="ai-color-icon-{{ ai_gen_id }} ai-color-icon-{{ color_type }}-{{ ai_gen_id }} {% if forloop.first %}selected{% endif %}"
            style="--ai-color-value-{{ ai_gen_id }}: {{ color_value }};"
            data-color="{{ color_value }}"
            data-label="{{ color_label }}"
            aria-label="Select {{ color_label }} color"
            type="button"
          >
        {% endif %}
        {% if color_type == 'image' and color_image %}
            <img
              src="{{ color_image | image_url: width: 100 }}"
              alt="{{ color_label }}"
              loading="lazy"
            >
          {% endif %}
          
          {% if block.settings.show_checkmark and linked_product == blank %}
            <svg
              class="ai-color-icon-checkmark-{{ ai_gen_id }}"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="3"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
          {% endif %}
          
        {% if linked_product != blank %}
          </a>
        {% else %}
          </button>
        {% endif %}
        
        {% if block.settings.show_labels and color_label != blank %}
          <div class="ai-color-label-{{ ai_gen_id }}">{{ color_label }}</div>
        {% endif %}

        {% if linked_product != blank and block.settings.show_product_info %}
          <div class="ai-product-info-{{ ai_gen_id }}">
            {% if block.settings.show_product_price %}
              <div class="ai-product-price-{{ ai_gen_id }}">{{ linked_product.price | money }}</div>
            {% endif %}
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</color-picker-{{ ai_gen_id }}>

<script>
  (function() {
    class ColorPicker{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.colorIcons = this.querySelectorAll('.ai-color-icon-{{ ai_gen_id }}');
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.colorIcons.forEach((icon) => {
          if (icon.tagName.toLowerCase() === 'button') {
            icon.addEventListener('click', () => {
              this.selectColor(icon);
            });

            icon.addEventListener('keydown', (event) => {
              if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                this.selectColor(icon);
              }
            });
          }
        });
      }

      selectColor(selectedIcon) {
        this.colorIcons.forEach((icon) => {
          if (icon.tagName.toLowerCase() === 'button') {
            icon.classList.remove('selected');icon.setAttribute('aria-pressed', 'false');
          }
        });

        if (selectedIcon.tagName.toLowerCase() === 'button') {
          selectedIcon.classList.add('selected');
          selectedIcon.setAttribute('aria-pressed', 'true');

          const colorValue = selectedIcon.dataset.color;
          const colorLabel = selectedIcon.dataset.label;

          this.dispatchEvent(new CustomEvent('colorChanged', {
            detail: {
              color: colorValue,
              label: colorLabel
            },
            bubbles: true
          }));
        }
      }
    }

    customElements.define('color-picker-{{ ai_gen_id }}', ColorPicker{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Color picker icons",
  "settings": [
    {
      "type": "header",
      "content": "Display"
    },
    {
      "type": "checkbox",
      "id": "show_labels",
      "label": "Show color labels",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_checkmark",
      "label": "Show checkmark on selection",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_info",
      "label": "Show product information",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_price",
      "label": "Show product price",
      "default": true
    },
    {
      "type": "header",
      "content": "Icon style"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Icon size",
      "default": 40
    },
    {
      "type": "range",
      "id": "icon_spacing",
      "min": 4,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Icon spacing",
      "default": 8
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 20
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Border width",
      "default": 0
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e6e6e6"
    },
    {
      "type": "range",
      "id": "hover_scale",
      "min": 1,
      "max": 1.3,
      "step": 0.1,
      "label": "Hover scale",
      "default": 1.1
    },
    {
      "type": "header",
      "content": "Selection style"
    },
    {
      "type": "range",
      "id": "selected_border_width",
      "min": 1,
      "max": 6,
      "step": 1,
      "unit": "px",
      "label": "Selected border width",
      "default": 3
    },
    {
      "type": "color",
      "id": "selected_border_color",
      "label": "Selected border color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "selected_ring_color",
      "label": "Selected ring color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "checkmark_color",
      "label": "Checkmark color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Labels"
    },
    {
      "type": "range",
      "id": "label_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Label font size",
      "default": 12
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Price font size",
      "default": 12
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Pattern colors"
    },
    {
      "type": "color",
      "id": "pattern_secondary_color",
      "label": "Pattern secondary color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "gradient_end_color",
      "label": "Gradient end color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Color 1"
    },
    {
      "type": "checkbox",
      "id": "color_1_enabled",
      "label": "Enable color 1",
      "default": true
    },
    {
      "type": "select",
      "id": "color_1_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_1_value",
      "label": "Color",
      "default": "#ff0000"
    },
    {
      "type": "text",
      "id": "color_1_label",
      "label": "Label",
      "default": "Red"
    },
    {
      "type": "image_picker",
      "id": "color_1_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_1_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 2"
    },
    {
      "type": "checkbox",
      "id": "color_2_enabled",
      "label": "Enable color 2",
      "default": true
    },
    {
      "type": "select",
      "id": "color_2_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_2_value",
      "label": "Color",
      "default": "#0000ff"
    },
    {
      "type": "text",
      "id": "color_2_label",
      "label": "Label",
      "default": "Blue"
    },
    {
      "type": "image_picker",
      "id": "color_2_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_2_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 3"
    },
    {
      "type": "checkbox",
      "id": "color_3_enabled",
      "label": "Enable color 3",
      "default": true
    },
    {
      "type": "select",
      "id": "color_3_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_3_value",
      "label": "Color",
      "default": "#00ff00"
    },
    {
      "type": "text",
      "id": "color_3_label",
      "label": "Label",
      "default": "Green"
    },
    {
      "type": "image_picker",
      "id": "color_3_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_3_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 4"
    },
    {
      "type": "checkbox",
      "id": "color_4_enabled",
      "label": "Enable color 4",
      "default": true
    },
    {
      "type": "select",
      "id": "color_4_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_4_value",
      "label": "Color",
      "default": "#ffff00"
    },
    {
      "type": "text",
      "id": "color_4_label",
      "label": "Label",
      "default": "Yellow"
    },
    {
      "type": "image_picker",
      "id": "color_4_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_4_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 5"
    },
    {
      "type": "checkbox",
      "id": "color_5_enabled",
      "label": "Enable color 5",
      "default": false
    },
    {
      "type": "select",
      "id": "color_5_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_5_value",
      "label": "Color",
      "default": "#ff00ff"
    },
    {
      "type": "text",
      "id": "color_5_label",
      "label": "Label",
      "default": "Magenta"
    },
    {
      "type": "image_picker",
      "id": "color_5_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_5_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 6"
    },
    {
      "type": "checkbox",
      "id": "color_6_enabled",
      "label": "Enable color 6",
      "default": false
    },
    {
      "type": "select",
      "id": "color_6_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_6_value",
      "label": "Color",
      "default": "#00ffff"
    },
    {
      "type": "text",
      "id": "color_6_label",
      "label": "Label",
      "default": "Cyan"
    },
    {
      "type": "image_picker",
      "id": "color_6_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_6_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 7"
    },
    {
      "type": "checkbox",
      "id": "color_7_enabled",
      "label": "Enable color 7",
      "default": false
    },
    {
      "type": "select",
      "id": "color_7_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_7_value",
      "label": "Color",
      "default": "#ffa500"
    },
    {
      "type": "text",
      "id": "color_7_label",
      "label": "Label",
      "default": "Orange"
    },
    {
      "type": "image_picker",
      "id": "color_7_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_7_product",
      "label": "Linked product"
    },
    {
      "type": "header",
      "content": "Color 8"
    },
    {
      "type": "checkbox",
      "id": "color_8_enabled",
      "label": "Enable color 8",
      "default": false
    },
    {
      "type": "select",
      "id": "color_8_type",
      "label": "Type",
      "options": [
        {
          "value": "solid",
          "label": "Solid"
        },
        {
          "value": "pattern",
          "label": "Pattern"
        },
        {
          "value": "gradient",
          "label": "Gradient"
        },
        {
          "value": "image",
          "label": "Image"
        }
      ],
      "default": "solid"
    },
    {
      "type": "color",
      "id": "color_8_value",
      "label": "Color",
      "default": "#800080"
    },
    {
      "type": "text",
      "id": "color_8_label",
      "label": "Label",
      "default": "Purple"
    },
    {
      "type": "image_picker",
      "id": "color_8_image",
      "label": "Image"
    },
    {
      "type": "product",
      "id": "color_8_product",
      "label": "Linked product"
    }
  ],
  "presets": [
    {
      "name": "Color picker icons"
    }
  ]
}
{% endschema %}